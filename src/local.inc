
struct H5aParser
  input_stream.get_char_cb  dq ?
  input_stream.user_data    dq ?

  tokenizer.char_ref        dq ?

  tokenizer.state           db ?
  tokenizer.return_state    db ?
  treebuilder.mode          db ?
  treebuilder.original_mode db ?
ends

enum
  DATA_STATE = 0
  RCDATA_STATE
  RAWTEXT_STATE
  SCRIPT_DATA_STATE
  PLAINTEXT_STATE
  TAG_OPEN_STATE
  END_TAG_OPEN_STATE
  TAG_NAME_STATE
  RCDATA_LESS_THAN_SIGN_STATE
; ...
  SCRIPT_DATA_DOUBLE_ESCAPE_END_STATE
  BEFORE_ATTRIBUTE_NAME_STATE
  ATTRIBUTE_NAME_STATE
  AFTER_ATTRIBUTE_NAME_STATE
  BEFORE_ATTRIBUTE_VALUE_STATE
  ATTRIBUTE_VALUE_DOUBLE_QUOTED_STATE
  ATTRIBUTE_VALUE_SINGLE_QUOTED_STATE
  ATTRIBUTE_VALUE_UNQUOTED_STATE
  AFTER_ATTRIBUTE_VALUE_QUOTED_STATE
  SELF_CLOSING_START_TAG_STATE
  BOGUS_COMMENT_STATE
  MARKUP_DECLARATION_OPEN_STATE
  COMMENT_START_STATE
  COMMENT_START_DASH_STATE
  COMMENT_STATE
  COMMENT_LESS_THAN_SIGN_STATE
  COMMENT_LESS_THAN_SIGN_BANG_STATE
  COMMENT_LESS_THAN_SIGN_BANG_DASH_STATE
  COMMENT_LESS_THAN_SIGN_BANG_DASH_DASH_STATE
  COMMENT_END_DASH_STATE
  COMMENT_END_STATE
  COMMENT_END_BANG_STATE
  DOCTYPE_STATE
  BEFORE_DOCTYPE_NAME_STATE
  DOCTYPE_NAME_STATE
  AFTER_DOCTYPE_NAME_STATE
  AFTER_DOCTYPE_PUBLIC_KEYWORD_STATE
  BEFORE_DOCTYPE_PUBLIC_IDENTIFIER_STATE
  DOCTYPE_PUBLIC_IDENTIFIER_DOUBLE_QUOTED_STATE
  DOCTYPE_PUBLIC_IDENTIFIER_SINGLE_QUOTED_STATE
  AFTER_DOCTYPE_PUBLIC_IDENTIFIER_STATE
  BETWEEN_DOCTYPE_PUBLIC_AND_SYSTEM_IDENTIFIERS_STATE
  AFTER_DOCTYPE_SYSTEM_KEYWORD_STATE
  BEFORE_DOCTYPE_SYSTEM_IDENTIFIER_STATE
  DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED_STATE
  DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED_STATE
  AFTER_DOCTYPE_SYSTEM_IDENTIFIER_STATE
  BOGUS_DOCTYPE_STATE
  CDATA_SECTION_STATE
  CDATA_SECTION_BRACKET_STATE
  CDATA_SECTION_END_STATE
  CHARACTER_REFERENCE_STATE
  NAMED_CHARACTER_REFERENCE_STATE
  AMBIGUOUS_AMPERSAND_STATE
  NUMERIC_CHARACTER_REFERENCE_STATE
  HEXADECIMAL_CHARACTER_REFERENCE_START_STATE
  DECIMAL_CHARACTER_REFERENCE_START_STATE
  HEXADECIMAL_CHARACTER_REFERENCE_STATE
  DECIMAL_CHARACTER_REFERENCE_STATE
  NUMERIC_CHARACTER_REFERENCE_END_STATE
  NUM_STATES
end enum

enum
  RESULT_BIT_AGAIN = (1 shl 1)
  RESULT_BIT_LEAVE = (1 shl 2)
  RESULT_BIT_CLEANUP = (1 shl 3)
end enum

enum
  RESULT_OK = (0x0)
  RESULT_IGNORE = (0x0 + 0x1)
  RESULT_RECONSUME = (RESULT_BIT_AGAIN + 0x0)
  RESULT_REPROCESS = (RESULT_BIT_AGAIN + 0x1)
  RESULT_EOF_REACHED = ((RESULT_BIT_CLEANUP or RESULT_BIT_LEAVE) + 0x0)
  RESULT_STOP = ((RESULT_BIT_CLEANUP or RESULT_BIT_LEAVE) + 0x1)
end enum

enum
  STATE_BIT_SPC_ACTION = (1 shl 0)
  STATE_BIT_NO_GETCHAR = (1 shl 1)
end enum

enum
  TOKEN_CHARACTER
  TOKEN_WHITESPACE
  TOKEN_DOCTYPE
  TOKEN_START_TAG
  TOKEN_END_TAG
  TOKEN_COMMENT
  TOKEN_EOF
end enum

;;
;; Public
;;
struct H5aParserCreateInfo
  get_char   dq ?
  user_data  dq ?
ends

enum
  H5A_SUCCESS = 0
  H5A_FAILURE = 1
  H5A_PAUSED  = 2
end enum

